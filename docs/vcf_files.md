# Description of VCF files generated by TRGT

The [Variant Calling Format (VCF)](https://samtools.github.io/hts-specs/VCFv4.3.pdf)
files generated by TRGT describe the lengths, sequence composition, CpG
methylation, and other properties of tandem repeats. The TRGT VCF file
provides an analysis-ready summary of each genotyped repeat defined in the input
catalog. TRGT outputs complete allele sequences (with a leading padding
base) along with sample-level annotations capturing length,
composition, support, purity, and methylation data.

Each VCF record contains the standard columns listed below.

| VCF field | Description                                                          |
|-----------|----------------------------------------------------------------------|
| CHROM     | Chromosome containing the repeat region                              |
| POS       | Starting position of the repeat region (minus 1 due to padding base) |
| ID        | Region identifier (currently set to ".")                             |
| REF       | The full reference sequence of the region (plus padding base)        |
| ALT       | Sequences of the repeat alleles (plus padding base)                  |
| QUAL      | Currently always set to "."                                          |
| FILTER    | Currently always set to "."                                          |
| INFO      | Fields describing the overall properties of the TR region            |
| FORMAT    | Names of genotype fields describing the region in the sample         |
| SAMPLE    | Values of genotype fields describing the region in the sample        |

Beyond the core columns, TRGT encodes locus-level details in the INFO
field and sample-level measurements in the FORMAT/SAMPLE columns.

## Information fields (INFO)

Information fields describe the overall structure of the repeat region,
independent of any particular sample. TRGT writes the following keys:

| INFO field | Description                                               | Example            |
|------------|-----------------------------------------------------------|--------------------|
| TRID       | Identifier of the repeat region from the input catalog    | HTT                |
| END        | Ending position of the repeat region                      | 3074966            |
| MOTIFS     | Comma separated list of motif units observed at the locus | CAG,CCG            |
| STRUC      | Expected locus structure (deprecated)                     | (CAG)nCAACAG(CCG)n |

## Genotype fields (FORMAT)

The final column list per-sample FORMAT names and their comma-separated
values. TRGT currently emits the keys below (values are given in allele order):

| Genotype field | Description                                                     | Example       |
|----------------|-----------------------------------------------------------------|---------------|
| GT             | Diploid genotype using standard VCF allele numbering            | 1/2           |
| AL             | Allele lengths in base pairs                                    | 84,105        |
| ALLR           | Length confidence interval for each allele in "low-high" format | 80-85,102-114 |
| SD             | Number of supporting reads per allele                           | 28,18         |
| MC             | Motif copy counts per allele, matching the order in `MOTIFS`    | 17_9,24_9     |
| MS             | Run-length segmentation string per allele                       | 0(0-51)_1(57-84),0(0-72)_1(78-105) |
| AP             | Allele purity (fraction of motif bases)                         | 0.5,0.9       |
| AM             | Mean 5mCpG methylation level per allele (`.` when no CpG sites or methylation data unavailable) | 0.4,0.5       |

## MC and MS fields

The `MC` field contains the count of motifs of each TR on each allele. For
example, if the `MC` field is `17_9,24_9` and the `MOTIFS` field is `CAG,CCG`,
then one allele contains 17 CAGs and 9 CCGs while the second allele contains 24
CAGs and 9 CCGs (see panels A and B of the figure below).

The `MS` field contains spans of each TR on each allele. Each block is encoded
as `<motifIndex>(start-end)` using 0-based, half-open coordinates on the allele
sequence. For example, if the `MS` field is `0(0-51)_1(57-84),0(0-72)_1(78-105)`
and the `MOTIFS` field is `CAG,CCG`, then the CAG repeat (`motifIndex` 0) spans
bases 0 to 51 on the first allele and bases 0 to 72 on the second allele. The
CCG repeat (`motifIndex` 1) spans bases 57 to 84 on the first allele and bases
78 to 105 on the second allele (see panels A and C of the figure below).

<img width="600px" src="figures/VCF-overview.png"/>

## AP field

The `AP` field contains *purity score* for each repeat allele. The score is a
value between 0.0 and 1.0. If it is 1.0, the allele consists of the perfect
repetition of the consensus motif. The closer this score is to 0.0, the more
degenerate is the repeat. More formally, the purity score is defined through the
[edit distance](https://en.wikipedia.org/wiki/Edit_distance): If `E` is the edit
distance between the allele of length `L` and the perfect repeat of the same
length, the purity score is defined by `(L - E) / L`.
